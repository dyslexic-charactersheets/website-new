<!-- 
  Copyright 2025 Marcus Downing
  Licensed under the Artistic License 2.0
-->

<template>
  <form
    id="build-form"
    class="build-form"
    data-edition=""
    data-pick=""
    data-ancestry=""
    data-heritage=""
    data-background=""
    data-cls=""
    data-multiclass="[]"
    data-archetype="[]"
    data-diehard="false"
    data-option-debug="false"
    data-free-archetype="false"
    data-ancestry-paragon="false"
    data-automatic-bonus-progression="false"
    data-proficiency-without-level="false"
  >
    {{> SlideshowButtons
      for='slides-character'
    }}

    {{#> Slideshow 
      id="slides-character"
      vertical=true
    }}

      {{#> Slide jump="pick" first=true}}
        {{> BuildFormPF2_PickSlide }}
      {{/Slide}}

      {{#> Switch 
        id="switch-character"
        current=""
      }}
        {{#> SwitchCase value='character'}}

          {{#> Slide jump="character" show-next=true }}
            {{> BuildFormPF2_CharacterSlide }}
          {{/Slide}}
          
          {{#> Slide jump="pages" show-next=true }}
            {{> BuildFormPF2_PagesSlide }}
          {{/Slide}}
          
          {{#> Slide jump="colours" show-next=true }}
            {{> BuildFormPF2_AppearanceSlide }}
          {{/Slide}}
          
          {{#> Slide jump="picture" show-next=true }}
            {{> BuildFormPF2_PictureSlide type="character" }}
          {{/Slide}}
          
          {{#> Slide jump="download" last=true }}
            {{> BuildFormPF2_DownloadSlide
              type="character"
            }}
          {{/Slide}}

        {{/SwitchCase}}

        {{#> SwitchCase value='gm'}}
          
          {{#> Slide jump="gm-pick" slide=1 }}
          
            {{#> TileGrid grid="2-2" }}
              {{#> Button 
                type="tile"
                on-click="#switch-gm-options.current=npcs; #build-form.gm=characters; #slides-character.jump=gm-options"
              }}
                {{__ "NPCs"}}
              {{/Button}}

              {{#> Button 
                type="tile"
                on-click="#switch-gm-options.current=maps; #build-form.gm=maps; #slides-character.jump=gm-options"
              }}
                {{__ "Maps"}}
              {{/Button}}

              {{!-- {{#> Button 
                type="tile"
                on-click="#switch-gm-options.current=kingdom; #build-form.gm=kingmaker; #slides-character.jump=gm-options"
              }}
                {{__ "Kingdom"}}
              {{/Button}} --}}
            {{/TileGrid}}
          {{/Slide}}

          {{#> Slide jump="gm-options" slide=2 show-next=true }}
            <h2>GM</h2>
            {{#> Switch
              id="switch-gm-options"
              current=""
            }}
              {{#> SwitchCase value="npcs"}}
                {{> BuildFormPF2_GM_NPC }}
              {{/SwitchCase}}
              
              {{#> SwitchCase value="maps"}}
                {{> BuildFormPF2_GM_Maps }}
              {{/SwitchCase}}
              
              {{#> SwitchCase value="kingdom"}}
                {{> BuildFormPF2_Kingmaker }}
              {{/SwitchCase}}
            {{/Switch}}
          {{/Slide}}
          
          {{#> Slide jump="gm-colours" slide=3 show-next=true }}
            {{> BuildFormPF2_AppearanceSlide }}
          {{/Slide}}
          
          {{#> Slide jump="gm-download" slide=4 last=true }}
            {{> BuildFormPF2_DownloadSlide
              type="gm"
            }}
          {{/Slide}}
        {{/SwitchCase}}

        {{#> SwitchCase value="starship"}}
          {{#> Slide jump="starship" slide=3 show-next=true }}
            <h2>Starship</h2>
            <p>Starship</p>
          {{/Slide}}

          {{#> Slide jump="starship-colours" slide=3 show-next=true }}
            <p>Colours</p>
          {{/Slide}}
          
          {{#> Slide jump="starship-download" slide=4 last=true }}
            {{> BuildFormPF2_DownloadSlide
              type="starship"
            }}
          {{/Slide}}
        {{/SwitchCase}}

        {{#> SwitchCase value="kingmaker"}}
          {{#> Slide jump="kingmaker" slide=3 show-next=true }}
            {{> BuildFormPF2_Kingmaker }}
          {{/Slide}}

          {{#> Slide jump="kingmaker-colours" slide=3 show-next=true }}
            {{> BuildFormPF2_AppearanceSlide }}
          {{/Slide}}
          
          {{#> Slide jump="kingmaker-download" slide=4 last=true }}
            {{> BuildFormPF2_DownloadSlide
              type="kingmaker"
            }}
          {{/Slide}}
        {{/SwitchCase}}

        {{#> SwitchCase value="mini"}}
          {{#> Slide jump="mini" slide=3 show-next=true }}
            {{> BuildFormPF2_Mini show-logo=false }}
          {{/Slide}}

          {{#> Slide jump="mini-colours" slide=3 show-next=true }}
            {{> BuildFormPF2_AppearanceSlide }}
          {{/Slide}}
          
          {{#> Slide jump="mini-download" slide=4 last=true }}
            {{> BuildFormPF2_DownloadSlide
              type="mini"
            }}
          {{/Slide}}
        {{/SwitchCase}}

      {{/Switch}}
    {{/Slideshow}}
  </form>
</template>

<script>
const urlParams = new URLSearchParams(window.location.search);
const edition = urlParams.get('edition');
if (edition == "pathfinder2") {
  document.getElementById('build-form').dataset.edition = "pathfinder2";
} else if (edition == "pathfinder2remaster") {
  document.getElementById('build-form').dataset.edition = "pathfinder2remaster";
} else if (edition == "both") {
  document.getElementById('build-form').dataset.edition = "all";
} else if (window.location.pathname.match(/starfinder2/)) {
  document.getElementById('build-form').dataset.edition = 'starfinder2';
}

definePipe('editionName', (value) => {
  switch (value) {
    case 'pathfinder':
      return 'Pathfinder';
    case 'starfinder':
      return 'Starfinder';
    case 'pathfinder2':
      return 'Pathfinder 2e Legacy';
    case 'pathfinder2remaster':
      return 'Pathfinder 2e Remaster';
    case 'starfinder2':
      return 'Starfinder 2e';
    case 'all':
      return 'Both';
    default:
      return "";
  }
});
</script>
